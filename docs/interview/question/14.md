## :question:æƒ…äººèŠ‚ç¦åˆ©é¢˜ï¼Œå¦‚ä½•å®žçŽ°ä¸€ä¸ª new

é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ new åˆ°åº•åšäº†ä»€ä¹ˆäº‹æƒ…

æˆ‘ä»¬æ¥ä¸¾ä¸€ä¸ª ðŸŒ°

```js
function Animal(name) {
  this.name = name
  this.type = 'Animal'
}
Animal.prototype.ability = 'eat'

Animal.prototype.say = function() {
  console.log(`æˆ‘å±žäºŽ -> ${this.type} ç±»åž‹,ä½†æ˜¯æˆ‘çš„åå­—æ˜¯ -> ${this.name}`)
}

// å£°æ˜Žä¸€ä¸ªç‹—ç‹—
const dog = new Animal('dog')

console.log(dog.name) // dog
console.log(dog.type) // Animal
console.log(dog.ability) // eat
dog.say() // æˆ‘å±žäºŽ -> Animal ç±»åž‹,ä½†æ˜¯æˆ‘çš„åå­—æ˜¯ -> dog
// æˆ‘ä»¬å¯ä»¥è®¿é—® Animal æž„é€ å‡½æ•°çš„å±žæ€§
// æˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨ Animal.prototype ä¸­çš„æ–¹æ³•åŠå±žæ€§
```

é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥

```js
function _new(fn, ...arg) {
  // æˆ‘ä»¬ä½¿ç”¨æž„é€ å‡½æ•° fn.prototype åˆ›å»ºä¸€ä¸ªå¯¹è±¡
  // ä½¿åˆ›å»ºçš„ obj.__proto__ = fn.prototype
  // è¿™é‡Œä¸ç®¡æ˜¯ä»¥ä»€ä¹ˆæ ·å½¢å¼åˆ›å»ºæ–°çš„å¯¹è±¡
  // å…¶ç›®çš„éƒ½æ˜¯ä¸ºäº†è®©æ–°åˆ›å»ºå¯¹è±¡çš„åŽŸåž‹ç­‰äºŽæž„é€ å‡½æ•°çš„åŽŸåž‹
  const obj = Object.create(fn.prototype)
  console.log('TCL: function_new -> fn.prototype', fn.prototype)
  // ä¿®æ”¹æž„é€ å‡½æ•° this æŒ‡å‘
  const ret = fn.apply(obj, arg)
  // ç¡®ä¿è¿”å›žå€¼ä¸€ç›´æ˜¯ä¸€ä¸ªå¯¹è±¡
  return ret instanceof Object ? ret : obj
}

const pag = _new(Animal, 'pag')

console.log(pag.name) // dog
console.log(pag.type) // Animal
console.log(pag.ability) // eat
pag.say() // æˆ‘å±žäºŽ -> Animal ç±»åž‹,ä½†æ˜¯æˆ‘çš„åå­—æ˜¯ -> pag
```

[è¿™é‡Œæœ‰ä¸€ç¯‡å°†åŽŸåž‹ä¸ŽåŽŸåž‹é“¾çš„](https://github.com/mqyqingfeng/Blog/issues/2)
